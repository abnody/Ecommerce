import{r,C as y,u as j,j as e,a as x,k as g}from"./index-B4CT-cHI.js";import{c as k,a as n,u as v}from"./index.esm-D_TNIXNq.js";function S(){const[N,o]=r.useState(null),[d,a]=r.useState(!1),[i,l]=r.useState(!1);let{cart:c}=r.useContext(y);const[u,m]=r.useState(null),b=j();async function p(h){if(u==="card"){a(!0);try{let{data:s}=await x.post(`https://ecommerce.routemisr.com/api/v1/orders/checkout-session/${c.cartId}?url=${encodeURIComponent("https://abnody.github.io/Ecommerce/#")}`,{shippingAddress:h},{headers:{token:localStorage.getItem("userToken")}});a(!1),g.success(s.status),location.href=s.session.url}catch(s){o(s.response.data.message),a(!1)}}if(u==="cash"){l(!0);try{let{data:s}=await x.post(`https://ecommerce.routemisr.com/api/v1/orders/${c.cartId}`,{shippingAddress:h},{headers:{token:localStorage.getItem("userToken")}});l(!1),g.success(s.status),b("/allorders")}catch(s){o(s.response.data.message),l(!1)}}}const f=k({city:n().required("This field is required"),details:n().required("This field is required"),phone:n().required("This field is required").matches(/^01[0-2,5]\d{8}$/,"Please enter a valid Egyption Mobile number")}),t=v({initialValues:{city:"",details:"",phone:""},validationSchema:f,onSubmit:p});return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full",children:e.jsxs("form",{className:"max-w-sm mx-auto py-7",onSubmit:t.handleSubmit,children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"city",className:"block mb-2 text-sm font-medium text-white",children:"Your city"}),e.jsx("input",{type:"text",id:"city",value:t.values.city,onChange:t.handleChange,onBlur:t.handleBlur,className:"shadow-xs bg-green-50 border border-green-300 text-green-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 ",required:!0})]}),t.touched.city&&t.errors.city?e.jsx("div",{className:"p-4 mb-5 -mt-3 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:t.errors.city}):null,e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"details",className:"block mb-2 text-sm font-medium text-white",children:"Your Address in details"}),e.jsx("input",{type:"text",id:"details",value:t.values.details,onChange:t.handleChange,onBlur:t.handleBlur,className:"shadow-xs bg-green-50 border border-green-300 text-green-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 ",required:!0})]}),t.touched.details&&t.errors.details?e.jsx("div",{className:"p-4 mb-5 -mt-3 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:t.errors.details}):null,e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"phone",className:"block mb-2 text-sm font-medium text-white",children:"Your phone"}),e.jsx("input",{type:"text",id:"phone",value:t.values.phone,onChange:t.handleChange,onBlur:t.handleBlur,className:"shadow-xs bg-green-50 border border-green-300 text-green-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 ",required:!0})]}),t.touched.phone&&t.errors.phone?e.jsx("div",{className:"p-4 mb-5 -mt-3 text-sm text-red-800 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400",role:"alert",children:t.errors.phone}):null,e.jsxs("div",{className:"flex items-center justify-between",children:[!d&&e.jsx("button",{type:"submit",onClick:()=>m("card"),className:" text-white bg-green-700 hover:bg-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center ",children:"Pay by Visa Card"}),d&&e.jsx("button",{type:"button",className:" text-white bg-green-700 hover:bg-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center ",children:e.jsx("i",{className:"fas fa-spinner fa-spin fa-lg"})}),!i&&e.jsx("button",{type:"submit",onClick:()=>m("cash"),className:"text-white bg-green-700 hover:bg-green-800 font-medium rounded-lg text-sm px-5 py-2.5  text-center ",children:"Cash "}),i&&e.jsx("button",{type:"button",className:"text-white bg-green-700 hover:bg-green-800 font-medium rounded-lg text-sm px-5 py-2.5  text-center ",children:e.jsx("i",{className:"fas fa-spinner fa-spin fa-lg"})})]})]})})})}export{S as default};
